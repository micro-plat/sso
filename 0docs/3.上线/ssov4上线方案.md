# sso_v4 系统功能模块上线说明书

### 〇、 SSOV4版本变动

#### 1. 数据库

```text
数据库无变动,无需处理
```

#### 2. 注册中心

```text
  1. 服务发生合并，原有服务不存在。注册中心节点不一致
     a. apiserver + lgapi + lgweb ==> loginserver
     b. mgrserver + mgrweb  ==> mgrserver
  2. 基础配置变化
       
```

#### 2. 业务系统交互联动

```text
  1. 登录系统与业务系统交互参数变化，并且不兼容
  2. 登录系统与业务系统接口变化
  3. sso_v4登录系统调整方式不一致
```


#### 3、部署说明

```text
1. 是否独立部署sso_v4版本？
  是, sso_v4版本与原版本不兼容，不能直接替换原系统 避免对业务系统造成不可用的影响。部署新的独立应用有效隔离。

2. 是否使用新域名？
  是，sso_v4独立部署，使用新域名来接收请求

3. 是否使用新的注册中心节点
  是，sso_v4独立部署，两个版本之间的参数差异较大，使用新节点分开参数配置方便清晰配置与维护

4. 是否信用新的数据库
  否，sso_v4版本对数据库未改动

5. 其他配置参考《发布流程.md》

```
 

### 一、 上线范围

sso_v4 的两个项目(loginserver, mgrserver)

#### 1. 服务列表

| 编号 | 机房  | 平台名称 |  系统名称   |  程序名称   | 部署说明 |
| ---: | :---: | :------: | :---------: | :---------: | :------- |
|    1 | 北京  |  sso_v4  | loginserver | loginserver | 新建     |
|    2 | 北京  |  sso_v4  |  mgrserver  |  mgrserver  | 新建     |



### 二、 上线安排

#### 1. 人员职责

| 编号  | 部门  | 人员  | 职责                                                  |
| :---: | :---: | :---: | :---------------------------------------------------- |
|   1   | 运维  | 严勇  | 系统部署                                              |
|   3   | 测试  | 罗蛟  | 程序打包, 上线后系统验证 （参数修改参考《发布流程》） |


### 三、资源准备

#### 1. 域名

| 编号  |          域名          | 内网端口 | 外网端口 |
| :---: | :--------------------: | :------: | :------- |
|   1   |   ssov4.18jiayou.com   |   6687   | 80 / 443 |
|   2   | api.ssov4.18jiayou.com |   6689   | 80       |
|   3   | web.ssov4.18jiayou.com |   6677   | 80       |

#### 2. https证书

| 编号  |        域名        |    要求    |
| :---: | :----------------: | :--------: |
|   1   | ssov4.18jiayou.com | 免费就可以 |

 
#### 3. 服务器
 
| 编号  | 项目编号    | 备注                             |
| :---: | :---------- | :------------------------------- |
|   1   | loginserver | 使用原服务器 (172.16.10.221/222) |
|   2   | mgrserver   | 使用原服务器 (172.16.10.221/222) |


#### 4. 关联项目
 
| 编号  | 项目编号 | 需要资源          | 备注         |
| :---: | :------- | :---------------- | :----------- |
|   1   | wetoken  | 服务地址，wxappid | 新版本未部署 |
|   2   | sms      | 服务地址，模版id  | 新版本未部署 |

 


### 四、 发布说明

#### 1、目录结构说明(程序对应的域名和端口)

``` 
loginserver:
/sso_v4/loginserver/bin/loginserver   
/sso_v4/loginserver/bin/login.static.zip

loginserver端口:6687   域名: ssov4.18jiayou.com
loginserver端口:6689   域名: api.ssov4.18jiayou.com

--------------------
mgrserver:

/sso_v4/mgrserver/bin/mgrserver  
/sso_v4/mgrserver/bin/mgr.static.zip

mgrserver端口:6677   域名: web.ssov4.18jiayou.com
```

#### 3、 图片同步

``` 
sso_v4/mgrserver/image 里面的图片要同步到  http://bj.images.18jiayou.com ->  sso_v4 文件夹中(图片服务器中需要创建一个sso_v4文件夹)

如 123456.jpg
最终生成的图片地址为: http://bj.images.18jiayou.com/sso_v4/123456.jpg
```

### 五、 发布验证

```text
参考发布流程中验证环境
```


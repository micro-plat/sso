# sso 系统功能模块上线说明书

### 一、 上线范围
sso 的五个项目(apiserver_sso, lgapi_sso, lgweb_sso, mgrapi_sso, mgrweb_sso)


#### 1. 服务列表

| 编号 | 机房 |  系统名称  | 子系统名称 |  程序名称  | 部署说明 |
| ---: | :--: | :--------: | :--------: | :--------: | :------- |
|    1 | 北京 | sso |  apiserver  | apiserver_sso | 新建 |
|    2 | 北京 | sso |  loginserver  | lgapi_sso | 新建 |
|    3 | 北京 | sso |  loginserver  | lgweb_sso | 新建 |
|    4 | 北京 | sso |  mgrserver  | mgrapi_sso | 新建 |
|    5 | 北京 | sso |  mgrserver  | mgrweb_sso | 新建 |

### 二、 上线安排

#### 1. 人员职责

| 编号 | 部门 |  人员  | 职责               |
| :--: | :--: | :----: | :----------------- |
|  1   | 运维 |  严勇  | 系统部署           |
|  2   | 研发 | 张晓辉 | 程序打包，上线协调 |
|  3   | 测试 |  罗蛟  | 上线后系统验证     |

#### 2. 顺序流程

| 顺序 |      时间       | 事务                   |       部门       |
| :--: | :-------------: | :--------------------- | :--------------: |
|  2   | 2019/8/20 15:30 | 程序打包               |       研发       |
|  3   | 2019/8/20 16:00 | 启动新服务             |       运维       |
|  4   | 2019/8/20 17:00 | 线上验证               |    研发、测试    |




### 三、 发布说明

#### 1、目录结构说明(程序对应的域名和端口)
```
sso
    apiserver/bin/apiserver_sso  端口:80   域名: api.sso.18jiayou.com
    loginserver/bin/
        lgapi_sso                端口:80   域名: loginapi.sso.18jiayou.com
        lgweb_sso                端口:80   域名：login.sso.18jiayou.com
        static.zip
    mgrserver/bin/
        mgrapi_sso               端口:80   域名：webapi.sso.18jiayou.com
        mgrweb_sso               端口:80     域名: web.sso.18jiayou.com
        static.zip
```

#### 2、启动流程
``` shell
apiserver
    ./apiserver_sso install -r zk://zookeeper地址 -c v3
    ./apiserver_sso start 

loginserver 里面有两个项目
    ./lgapi_sso install -r zk://zookeeper地址 -c v3
    ./lgapi_sso start

    ./lgweb_sso install -r zk://zookeeper地址 -c v3
    ./lgweb_sso start 

mgrserver 里面有两个项目
    ./mgrapi_sso install -r zk://zookeeper地址 -c v3
    ./mgrapi_sso start

    ./mgrweb_sso install -r zk://zookeeper地址 -c v3
    ./mgrweb_sso start
		
```
#### 3、 图片同步
```
sso/mgrserver/image 里面的图片要同步到  http://bj.images.cdqykj.cn ->  sso 文件夹中(图片服务器中需要创建一个sso文件夹)

最终生成的图片地址为: http://bj.images.cdqykj.cn/sso/124563.jpg
```